# Librairies
```{r}
library(DBI)
library(RMariaDB)
library(jsonlite)
library(readxl)
library(rvest)
library(pdftools)
library(progress)
library(tidyverse)
library(shiny)
```

# Connexion à la BDD mysql
```{r}
db_user <- '384054_admin'
db_password <- 'qZ9XcWesVVq9tiY'
db_name <- 'tp-groupe-r_airport'
db_host <- 'mysql-tp-groupe-r.alwaysdata.net'
db_port <- 3306

# Connexion à la base de données
mydb <- dbConnect(MariaDB(), user = db_user, password = db_password,
                  dbname = db_name, host = db_host, port = db_port)
```

# Insertion des données
```{r}
json_data <- fromJSON("data/airlines.json")
dbWriteTable(mydb, "airlines", json_data, row.names = FALSE, overwrite = TRUE)

excel_data <- read_excel("data/airports.xlsx")
dbWriteTable(mydb, "airports", excel_data, row.names = FALSE, overwrite = TRUE)

flights_data <- read_excel("data/flights.xlsx")
n_rows <- nrow(flights_data)
chunk_size <- 1000
n_chunks <- ceiling(n_rows / chunk_size)
pb <- progress_bar$new(
  format = "  Importation [:bar] :percent en :elapsed",
  total = n_chunks, clear = FALSE, width = 60
)
for (i in seq(1, n_rows, by = chunk_size)) {
  chunk <- flights_data[i:min(i + chunk_size - 1, n_rows), ]
  dbWriteTable(mydb, "flights", chunk, row.names = FALSE, append = TRUE)
  pb$tick()
}
# dbWriteTable(mydb, "flights", flights_data, row.names = FALSE, overwrite = TRUE)

text <- pdf_text("data/weather.pdf")
lines <- str_split(text, "\n")[[1]]
data_list <- str_split(lines, ",") 
weather <- as.data.frame(do.call(rbind, data_list[-1]))
colnames(weather) <- c("origin","year","month","day","hour","temp","dewp","humid","wind_dir","wind_speed","wind_gust","precip","pressure","visib","time_hour")
dbWriteTable(mydb, "weather", weather, row.names = FALSE, overwrite = TRUE)

dbDisconnect(mydb)
```
